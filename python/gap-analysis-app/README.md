# 差額分析アプリ

開発計画金額と着地見込み額の乖離を分析・可視化するStreamlitアプリです。

## 機能

- **乖離分析**: 開発計画金額と着地見込み額の差額を可視化
- **アラート抽出**: 閾値以上の乖離がある施策を抽出
- **月次推移**: 月次内訳の自動生成と推移の可視化（合計・累計）
- **フィルタリング**: ISS区分、部門、担当者、組替有無でフィルタ
- **集計軸の切り替え**: 施策単位、ISS区分、部門、担当者、ISS区分×部門

## セットアップ

### 1. 仮想環境の作成と有効化

```bash
python -m venv .venv
source .venv/bin/activate  # Windowsの場合: .venv\Scripts\activate
```

### 2. 依存パッケージのインストール

```bash
pip install -r requirements.txt
```

## 実行方法

```bash
streamlit run app.py
```

ブラウザが自動的に開き、アプリが表示されます。

## 使い方

1. 左のサイドバーから**CSVファイルをアップロード**
2. **設定**でアラート閾値を調整（デフォルト: 20百万円）
3. **フィルタ**でISS区分、部門、担当者、組替有無を選択
4. **集計軸**で分析の切り口を選択
5. 画面に表示される以下の情報を確認:
   - KPI（施策数、合計金額、乖離、アラート件数）
   - 概況サマリ（集計表）
   - アラート施策一覧
   - 月次推移（合計・累計）
   - 明細データ

## 必須CSV列

CSVファイルには以下の列が必要です：

- `施策番号`
- `ISS区分`
- `施策名`
- `部門`
- `担当者`
- `開発計画金額`
- `着地見込み額`
- `実績`
- `組替有無`

## 月次内訳について

月次内訳（`開発計画_4月`～`開発計画_3月`、`着地見込み計画_4月`～`着地見込み計画_3月`）がCSVに含まれていない場合、自動的に生成されます。

- 各施策の年間合計と一致するように配分
- 施策番号から安定したseedを生成し、同じ配分を再現
- 「月次分があっても再生成」オプションで強制的に再生成可能

## 単位

金額はすべて**百万円**単位で扱われます。
- 例: `20` = 2,000万円

## データのダウンロード

フィルタ後のデータをCSV形式でダウンロードできます。
